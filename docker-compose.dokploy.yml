services:
  backend:
    image: ghcr.io/${GHCR_NAMESPACE}/avileo-backend:${BACKEND_IMAGE_TAG:-latest}
    container_name: avileo-backend
    restart: unless-stopped
    environment:
      DOPPLER_TOKEN: ${DOPPLER_TOKEN}
      DOPPLER_CONFIG: dev
      NODE_ENV: production
      PORT: 3000
    healthcheck:
      test: ['CMD', 'wget', '--spider', '-q', 'http://localhost:3000/health']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - avileo-network
      - dokploy-network

  app:
    image: ghcr.io/${GHCR_NAMESPACE}/avileo-app:${APP_IMAGE_TAG:-latest}
    container_name: avileo-app
    restart: unless-stopped
    environment:
      DOPPLER_TOKEN: ${DOPPLER_TOKEN}
      DOPPLER_CONFIG: dev
      NODE_ENV: production
      PORT: 3000
    depends_on:
      backend:
        condition: service_healthy
    networks:
      - avileo-network
      - dokploy-network

networks:
  avileo-network:
    name: avileo-network
  dokploy-network:
    external: true
